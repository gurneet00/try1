<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile System Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .info-box {
            background-color: #e9f7fe;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .button {
            display: block;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            text-decoration: none;
            margin-top: 20px;
            border: none;
            cursor: pointer;
            width: 100%;
        }
        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .toggle-label {
            margin-left: 10px;
        }
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4CAF50;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .data-display {
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .data-item {
            margin-bottom: 10px;
        }
        .data-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mobile System Monitor</h1>
        
        <div class="info-box">
            This app collects system information from your device and sends it to a monitoring server.
        </div>
        
        <div class="form-group">
            <label for="serverUrl">Server URL:</label>
            <input type="text" id="serverUrl" placeholder="http://your-server-ip:5000" value="http://localhost:5000">
        </div>
        
        <div class="form-group">
            <label for="authToken">Authentication Token:</label>
            <input type="text" id="authToken" placeholder="default_token_change_me" value="default_token_change_me">
        </div>
        
        <div class="form-group">
            <label for="updateInterval">Update Interval (seconds):</label>
            <input type="text" id="updateInterval" placeholder="60" value="60">
        </div>
        
        <div class="toggle-container">
            <label class="toggle">
                <input type="checkbox" id="monitoringToggle">
                <span class="slider"></span>
            </label>
            <span class="toggle-label">Enable Monitoring</span>
        </div>
        
        <button id="testConnectionBtn" class="button">Test Connection</button>
        <button id="updateNowBtn" class="button" style="margin-top: 10px;">Update Now</button>
        
        <div id="statusMessage" class="status" style="display: none;"></div>
        
        <div id="dataDisplay" class="data-display" style="display: none;">
            <h3>Last Collected Data:</h3>
            <div id="dataContent"></div>
        </div>
    </div>

    <script>
        // Generate a unique device ID and store it
        function generateDeviceId() {
            if (!localStorage.getItem('deviceId')) {
                const randomId = Math.random().toString(36).substring(2, 15) + 
                                Math.random().toString(36).substring(2, 15);
                localStorage.setItem('deviceId', randomId);
            }
            return localStorage.getItem('deviceId');
        }

        // Collect system data
        function collectSystemData() {
            const data = {
                timestamp: new Date().toISOString(),
                deviceId: generateDeviceId(),
                deviceInfo: {
                    deviceName: navigator.platform || 'Unknown Device',
                    systemName: navigator.userAgent.split(' ')[0] || 'Unknown',
                    systemVersion: navigator.appVersion || '',
                    deviceType: navigator.platform || '',
                    manufacturer: 'Unknown',
                    model: navigator.userAgent || 'Unknown'
                },
                batteryInfo: {
                    level: 0,
                    isCharging: false
                },
                storageInfo: {
                    total: 1000000000, // Simulated 1GB
                    free: 500000000,   // Simulated 500MB
                    used: 500000000,   // Simulated 500MB
                    usedPercentage: 50
                },
                memoryInfo: {
                    total: 2000000000, // Simulated 2GB
                    free: 1000000000,  // Simulated 1GB
                    used: 1000000000,  // Simulated 1GB
                    usedPercentage: 50
                },
                networkInfo: {
                    isConnected: navigator.onLine,
                    type: navigator.connection ? navigator.connection.type : 'unknown'
                },
                cpuInfo: {
                    usage: Math.floor(Math.random() * 100), // Simulated CPU usage
                    processorCount: 4, // Simulated 4 cores
                    model: 'Simulated CPU',
                    userUsage: Math.floor(Math.random() * 50),
                    systemUsage: Math.floor(Math.random() * 30),
                    idleUsage: Math.floor(Math.random() * 20)
                }
            };

            // Try to get battery info if available
            if (navigator.getBattery) {
                navigator.getBattery().then(function(battery) {
                    data.batteryInfo.level = battery.level * 100;
                    data.batteryInfo.isCharging = battery.charging;
                    updateDataDisplay(data);
                });
            }

            return data;
        }

        // Send data to server
        function sendDataToServer(data) {
            const serverUrl = document.getElementById('serverUrl').value;
            const authToken = document.getElementById('authToken').value;
            
            return fetch(`${serverUrl}/api/system-data`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                }
                return response.json();
            });
        }

        // Update the data display
        function updateDataDisplay(data) {
            const dataDisplay = document.getElementById('dataDisplay');
            const dataContent = document.getElementById('dataContent');
            
            dataDisplay.style.display = 'block';
            
            dataContent.innerHTML = `
                <div class="data-item">
                    <span class="data-label">Device ID:</span> ${data.deviceId}
                </div>
                <div class="data-item">
                    <span class="data-label">Device:</span> ${data.deviceInfo.deviceName}
                </div>
                <div class="data-item">
                    <span class="data-label">System:</span> ${data.deviceInfo.systemName} ${data.deviceInfo.systemVersion}
                </div>
                <div class="data-item">
                    <span class="data-label">CPU Usage:</span> ${data.cpuInfo.usage}%
                </div>
                <div class="data-item">
                    <span class="data-label">Memory:</span> ${Math.round(data.memoryInfo.used / 1024 / 1024)}MB / ${Math.round(data.memoryInfo.total / 1024 / 1024)}MB (${data.memoryInfo.usedPercentage}%)
                </div>
                <div class="data-item">
                    <span class="data-label">Storage:</span> ${Math.round(data.storageInfo.used / 1024 / 1024)}MB / ${Math.round(data.storageInfo.total / 1024 / 1024)}MB (${data.storageInfo.usedPercentage}%)
                </div>
                <div class="data-item">
                    <span class="data-label">Battery:</span> ${data.batteryInfo.level}% (${data.batteryInfo.isCharging ? 'Charging' : 'Not Charging'})
                </div>
                <div class="data-item">
                    <span class="data-label">Network:</span> ${data.networkInfo.isConnected ? 'Connected' : 'Disconnected'} (${data.networkInfo.type})
                </div>
                <div class="data-item">
                    <span class="data-label">Last Update:</span> ${new Date(data.timestamp).toLocaleString()}
                </div>
            `;
        }

        // Show status message
        function showStatus(message, type) {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = `status ${type}`;
            statusMessage.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Test connection
        document.getElementById('testConnectionBtn').addEventListener('click', function() {
            const data = collectSystemData();
            
            showStatus('Testing connection...', 'info');
            
            sendDataToServer(data)
                .then(response => {
                    showStatus('Connection successful!', 'success');
                    updateDataDisplay(data);
                })
                .catch(error => {
                    showStatus(`Connection failed: ${error.message}`, 'error');
                });
        });

        // Update now
        document.getElementById('updateNowBtn').addEventListener('click', function() {
            const data = collectSystemData();
            
            showStatus('Sending data...', 'info');
            
            sendDataToServer(data)
                .then(response => {
                    showStatus('Data sent successfully!', 'success');
                    updateDataDisplay(data);
                })
                .catch(error => {
                    showStatus(`Failed to send data: ${error.message}`, 'error');
                });
        });

        // Toggle monitoring
        let monitoringInterval;
        document.getElementById('monitoringToggle').addEventListener('change', function() {
            if (this.checked) {
                // Start monitoring
                const updateInterval = parseInt(document.getElementById('updateInterval').value) || 60;
                
                // Send initial data
                const data = collectSystemData();
                sendDataToServer(data)
                    .then(response => {
                        showStatus(`Monitoring started. Sending data every ${updateInterval} seconds.`, 'success');
                        updateDataDisplay(data);
                    })
                    .catch(error => {
                        showStatus(`Failed to start monitoring: ${error.message}`, 'error');
                        this.checked = false;
                    });
                
                // Set up interval
                monitoringInterval = setInterval(() => {
                    const data = collectSystemData();
                    sendDataToServer(data)
                        .then(response => {
                            updateDataDisplay(data);
                        })
                        .catch(error => {
                            showStatus(`Failed to send data: ${error.message}`, 'error');
                        });
                }, updateInterval * 1000);
            } else {
                // Stop monitoring
                clearInterval(monitoringInterval);
                showStatus('Monitoring stopped.', 'info');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved settings
            if (localStorage.getItem('serverUrl')) {
                document.getElementById('serverUrl').value = localStorage.getItem('serverUrl');
            }
            if (localStorage.getItem('authToken')) {
                document.getElementById('authToken').value = localStorage.getItem('authToken');
            }
            if (localStorage.getItem('updateInterval')) {
                document.getElementById('updateInterval').value = localStorage.getItem('updateInterval');
            }
            
            // Generate device ID
            generateDeviceId();
            
            // Save settings when changed
            document.getElementById('serverUrl').addEventListener('change', function() {
                localStorage.setItem('serverUrl', this.value);
            });
            document.getElementById('authToken').addEventListener('change', function() {
                localStorage.setItem('authToken', this.value);
            });
            document.getElementById('updateInterval').addEventListener('change', function() {
                localStorage.setItem('updateInterval', this.value);
            });
        });
    </script>
</body>
</html>
